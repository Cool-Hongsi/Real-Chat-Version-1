<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="fontello-fa271442/fontello-fa271442/css/fontello-embedded.css">
        <link rel="stylesheet" href="fontello-fa271442/fontello-fa271442/css/animation.css">
        <link rel="stylesheet" href="design1.css">
        <title>RealChat</title>
        <style>
            #contentWrap{
                display:none;
            }

        </style>
    </head>

    <body>
        <div id="nickWrap"> <!-- username 화면 -->
            <p id="inputusername">Enter a username : </p>
            <p id="nickError"></p>
            <form id="setNick">
                <input size="35" id="nickname"></input>
                <input type="submit">
            </form>
        </div>
        
        <div id="contentWrap"> <!-- chatting 화면 -->
            <div id="chatWrap">
                <textarea id="chat" readonly></textarea>
                <form id="send-message">
                    <input type="text" id="m"></input>
                    <input type="submit" value="전송"></input>
                </form>
            </div>
            <div id="users"></div>
        </div>
        
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        <script>
          $(function(){
            var socket = io();
            $('#setNick').on('submit', function(e){
                e.preventDefault(); // necessary
                socket.emit('new user', $('#nickname').val(), function(data){
                    if(data){ // 기존에 동일한 아이디가 없다면,
                        $('#nickWrap').hide(); // nickWrap 페이지를 없애고,
                        $('#contentWrap').show(); // contentWrap 페이지를 보여라.
                    }
                    else{ // 기존에 동일한 아이디가 있다면,
                        $('#nickError').html('That username is already taken! Try Again!');
                    }
                })
                $('#nickname').val('');
            });
                
            socket.on('usernames', function(data){ // 채팅창 오른쪽에 USERNAME 표시
                var output_username = '';
                    for(var i=0; i<data.length; i++){
                        output_username += `<i class="icon-child animate-spin"></i>` + data[i] + '<br>'
                    }
                $('#users').html(output_username); // append로 하면, username이 쌓인다.
            });
            
            $('#send-message').on('submit', function(e){
                e.preventDefault(); // necessary
                socket.emit('send message', $('#m').val());
                $('#m').val('');
            });

            socket.on('new message', function(data){
                $('#chat').append(data.nick + ' : ' + data.msg + '\n');
                $('#chat').scrollTop($('#chat')[0].scrollHeight);
            })
          })
        </script>
    </body>
</html>



<!--
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="bbb.css">
    <link rel="stylesheet" href="fontello-fa271442/fontello-fa271442/css/fontello-embedded.css">
    <link rel="stylesheet" href="fontello-fa271442/fontello-fa271442/css/animation.css">
    <title>Chat</title>
  </head>
  <body>
    <div id="usrlist">
      <h3>Online User</h3>
    </div>
    <div>
      <textarea id="chatLog" class="chat_log" readonly></textarea>
    </div>
    <form id="chat">
      <input id="name" class="name" type="text" readonly>
      <input id="message" class="message" type="text">
      <input type="submit" class="chat" value="chat"/>
    </form>
    <div id="box" class="box">
    <br><br>
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      var socket = io();
    
      socket.on('login', function(name){
        $('#name').val(name);
        $('#usrlist').append('<i class="icon-child animate-spin"></i>' + name);
    
      $('#chat').on('submit', function(e){
        socket.emit('send message', $('#name').val(), $('#message').val());
        $('#message').val("");
        $("#message").focus();
        e.preventDefault();
      });
      socket.on('receive message', function(msg){
        $('#chatLog').append(msg+'\n');
        $('#chatLog').scrollTop($('#chatLog')[0].scrollHeight);
      });

      socket.on('usernames', function(data){ // 채팅창 오른쪽에 USERNAME 표시
        var output_username = [];
        for(var i=0; i<data.length; i++){
            output_username[i] += data[i] + '<br>'
        }
        console.log(output_username[0] + ' , ' + output_username[1]);
            $('#usrlist').append(output_username); // append로 하면, username이 쌓인다.
            });
        });
    </script>
  </body>
</html>
-->
